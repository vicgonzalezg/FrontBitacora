{% extends "menu/layoutMenu.html" %}
{% load static %}
{% block title %}Menú Coach{% endblock %}
{% block head %}
<link rel="stylesheet" type="text/css" href="{% static 'css/style.css' %}">
<link rel="stylesheet" type="text/css" href="{% static 'css/all.css' %}">
<script type="text/javascript" src="{% static 'js/sweetalert2@11.js' %}"></script>
{% endblock %}
{% block content %}
{% for procesos in entity %}
<div class="row container">
    <H2 class="text-center col-md-12" name="nombreEmpre" id="nombreEmpre-{{ procesos.ID }}">Proceso Empresa:
        {{procesos.NOMBREEMPRESA}} </H2>
</div>
<!--Formulario del proceso y sus sesiones -->
<div class="container bg-light">
    <form class="form-horizontal" id="formModProcesoCoach-{{ procesos.ID }}"
        action="{% url 'infoProCoach' procesos.ID %}" method="POST">{% csrf_token %}
        <div class="container">
            <div class="panel panel-primary mt-2 px-2 bg-light">
                <!--Datos personales del coachee-->
                <div class="panel-body mt-2">
                    <br>
                    <div class="row">
                        <span class="col-md-6"></span>
                        <div class="col-md-6" >
                            <div class="col-md-12">
                                <label class="col-md-6 control-label" style="font-weight: bold;padding-left: 0px;padding-right: 0px;">Estado Proceso:</label>
                                <select class="col-md-12 form-select" name="estadoProceso" aria-label="Default select example"
                                {% if procesos.IDESTADOPROCESO == 6 %} disabled {% endif %}>
                                    {% for estado in estados %}
                                    <option value="{{estado.ID}}" {% if estado.ID < procesos.IDESTADOPROCESO %} hidden {% endif %} 
                                    {% if estado.ID == procesos.IDESTADOPROCESO %} selected {% endif %} 
                                    {% if estado.ID == 6 %} hidden {% endif %}>{{estado.DESCRIPCION}}</option>
                                    {% endfor %}
                                </select>
                            </div>
                        </div>
                    </div>
                    <div class="row">
                        <div class="form-group col-md-6">
                            <br>
                            <label class="col-md-6 control-label" name="nombre">Nombre Coachee</label>

                            <div class="col-md-12">
                                <input class="form-control" name="nombreCoachee" id="nombreCoachee-{{ procesos.ID }}"
                                    value="{{procesos.NOMBRE}} {{procesos.APELLIDO}}" readonly />
                            </div>
                        </div>
                        <div class="form-group col-md-6">
                            <br>
                            <label class="col-md-6 control-label">Nombre Jefe</label>
                            <div class="col-md-12 col-lg-8">
                                <input class="form-control" name="nombreJefe" id="nombreJefe-{{ procesos.ID }}"
                                    value="{{procesos.NOMBREJEFE}}" readonly>
                            </div>
                        </div>
                    </div>
                    <div class="row">
                        <div class="form-group col-md-6">
                            <br>
                            <label class="col-md-4 control-label">Email Coachee</label>
                            <div class="col-md-12">
                                <input class="form-control" name="correoCoachee" id="correoCoachee-{{ procesos.ID }}"
                                    value="{{procesos.CORREO}}" readonly>
                            </div>
                        </div>
                        <div class="form-group col-md-6">
                            <br>
                            <label class="col-md-5 control-label">Email Jefe</label>
                            <div class="col-md-12 col-lg-8">
                                <input class="form-control" name="correoJefe" id="correoJefe-{{ procesos.ID }}"
                                    value="{{procesos.EMAILJEFE}}" readonly>
                            </div>
                        </div>
                    </div>
                    <div class="row">
                        <div class="form-group col-md-6">
                            <br>
                            <label class="col-md-10 control-label" name="telefono">Telefono Coachee</label>

                            <div class="col-md-12">
                                <input class="form-control" name="telefonoCoachee"
                                    id="telefonoCoachee-{{ procesos.ID }}" value="{{procesos.FONO}}" readonly />
                            </div>
                        </div>
                        <div class="form-group col-md-6">
                            <br>
                            <label class="col-md-6 col control-label">Telefono Jefe</label>
                            <div>
                                <div class="col-md-12 col-lg-8">
                                    <input class="form-control" name="telefonoJefe" id="telefonoJefe-{{ procesos.ID }}"
                                        value="{{procesos.FONOJEFE}}" readonly>
                                </div>
                            </div>
                        </div>
                        <br>
                    </div>
                </div>
                <!--detalles del proceso-->
                <div class="panel panel-primary mt-4 px-2 bg-light">
                    <div class="panel-body">
                        <div class="row">
                            <div class="form-group col-md-6">
                                <br class="col-xs-12">
                                <label class="col-md-6 control-label" name="nombre">Objetivo del proceso:</label>
                                <div class="col-md-12">
                                    <textarea rows="5" class="form-control" name="objetivosProc"
                                        id="objetivosProc-{{ procesos.ID }}"
                                        {% if procesos.IDESTADOPROCESO == 6 %} readonly {% endif %}>{{procesos.OBJETIVOS}}</textarea>
                                </div>
                            </div>
                            
                            <div class="form-group col-md-6">
                                <br class="col-xs-12">
                                <label class="col-md-6 col-lg-4 control-label">Indicadores de exito:</label>
                                <div class="col-md-12 col-lg-8">
                                    <textarea rows="5" class="form-control" name="indicadoresProc"
                                        id="indicadoresProc-{{ procesos.ID }}"
                                        {% if procesos.IDESTADOPROCESO == 6 %} readonly {% endif %}>{{procesos.INDICADORES}}</textarea>
                                </div>
                            </div>
                        </div>
                        <br>
                    </div>
                </div>
                <div class="panel panel-primary px-2 bg-light">
                    <div class="panel-body">
                        <div class="row">
                            <div class="form-group col-md-6">
                                <label class="col-md-6 col-lg-4 control-label" name="nombre">Plan de Acción</label>
                                <div class="col-md-12">
                                    <textarea rows="7" class="form-control" name="planAccionProc"
                                        id="planAccionProc-{{ procesos.ID }}"
                                        {% if procesos.IDESTADOPROCESO == 6 %} readonly {% endif %}>{{procesos.PLANACCION}}</textarea>
                                </div>
                            </div>
                            <!--Tabla con registro de fechas de las sesiones-->
                            <div class=" form-group col-md-6">
                                <br>
                                <div class=" navbuttons col-md-12">
                                <table id="fechas" class="table thead-dark border border-dark">
                                    <thead class="thead-dark">
                                        <tr class="cabecera">
                                            <th scope="col">Sesión</th>
                                            <th scope="col">Fecha</th>
                                            <th scope="col">Hora</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        {% for sesion in sesiones %}
                                        <tr class="bg-light">
                                            {% if sesion.FECHASESION == None %}
                                            <th scope="row">Sesión: {{ forloop.counter }}</th>
                                            <th scope="row">Sin Agendar</th>
                                            <th scope="row">Sin Agendar</th>
                                            {% else %}
                                            <th scope="row">Sesión: {{ forloop.counter }}</th>
                                            <th scope="row">{{sesion.FECHASESION}}</th>
                                            <th scope="row">{{sesion.HORASESION}}</th>
                                            {% endif %}
                                        </tr>
                                        {% endfor %}
                                    </tbody>
                                </table>
                            </div>
                            </div>
                        </div>
                    </div>
                </div>
                <br>
                <div class="container">
                    <button type="submit" onclick="modProcesoCoach(this);" data-id="{{procesos.ID}}"
                        class="btn btn-primary float-end col-md-2"
                        {% if procesos.IDESTADOPROCESO == 6 %} disabled {% endif %}>Grabar</button>
                </div>
                <br>
                <br>
            </div>
    </form>

    <div class="container">
        <div class="row mt-3">
            <div class="col-md-12">
                <div class="row">
                    <!--registro de cada sesión-->
                    {% for sesion in sesiones %}
                    <p class="collapsible" id="{{ sesion.ID }}" onclick="fecha(this);">Sesión {{ forloop.counter }}</p>
                    <div class="content">
                        <div class="panel-body">
                            <!--Registro de Fecha/hora y estado de cada sesión-->
                            <form class="form-horizontal" enctype="application/x-www-form-urlencoded" action="{% url 'infoSesionCoach' sesion.ID %}"
                                id="formSesiones-{{ sesion.ID }}" method="POST">{% csrf_token %}
                                <div class="row">
                                    <div class="form-group col-md-6">
                                        <div class="row">
                                            <div class="form-group col-md-6">
                                                <label class="col-md-12 control-label" name="fechaSesion">Fecha
                                                    sesión:</label>
                                                <div class="col-md-12">
                                                    <input type="date"  name="fechaSesion"
                                                        id="fechaSesion-{{ sesion.ID }}" value="{{sesion.FECHASESION}}"
                                                        class="form-control" min="2021-10-01" 
                                                        {% if procesos.IDESTADOPROCESO == 6 or sesion.ESTADOSESION_ID == 4 %} readonly {% endif %} >
                                                </div>
                                            </div>
                                            <div class="form-group col-md-6">
                                                <label class="col-md-12 control-label" name="horaSesion">Hora
                                                    sesión:</label>
                                                <div id="hora" class="col-md-12">
                                                    <input class="col-md-12 p-1" name="horaSesion"
                                                        id="apptime-{{ sesion.ID }}" type="time" name="appt-time"
                                                        value="{{sesion.HORASESION}}"
                                                        {% if procesos.IDESTADOPROCESO == 6 or sesion.ESTADOSESION_ID == 4 %} disabled {% endif %}>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="form-group col-md-6">
                                        <label class="col-md-6 control-label" name="estadoSesion">Estado
                                            sesión:</label>
                                        <div class="col-md-12">
                                            <select class="form-select" name="estadoSesion1" id="estadoSesion1-{{ sesion.ID }}"
                                                aria-label="Default select example"
                                                {% if procesos.IDESTADOPROCESO == 6 or sesion.ESTADOSESION_ID == 4 %} disabled {% endif %}>
                                                {% for estSesion in estadosSesion %}
                                                <option name="estadoSesion" id="estadoSesion-{{ sesion.ID }}"
                                                    value="{{estSesion.ID}}" {% if estSesion.ID < sesion.ESTADOSESION_ID %} hidden {% endif %} 
                                                    {% if estSesion.ID == sesion.ESTADOSESION_ID %} selected {% endif %}>{{estSesion.DESCRIPCION}}</option>
                                                {% endfor %}
                                            </select>
                                        </div>
                                    </div>
                                </div>
                                <div class="row">
                                    <div class="form-group col-md-6">
                                        <br>
                                        <label class="col-md-6 control-label" name="descSesion">Descripción
                                            sesión:</label>

                                        <div class="col-md-12">
                                            <textarea rows="4" name="descSesion" class="form-control"
                                                id="descSesion--{{ sesion.ID }}"
                                                {% if procesos.IDESTADOPROCESO == 6 or sesion.ESTADOSESION_ID == 4 %} readonly {% endif %}>{{sesion.DESCRIPCION}}</textarea>
                                        </div>
                                    </div>
                                    <div class="form-group col-md-6">
                                        <br>
                                        <label class="col-md-6 control-label"
                                            name="asigSesion">Asignaciones/Acuerdos:</label>

                                        <div class="col-md-12">
                                            <textarea rows="4" name="asigSesion" class="form-control"
                                                id="asigSesion-{{ sesion.ID }}"
                                                {% if procesos.IDESTADOPROCESO == 6 or sesion.ESTADOSESION_ID == 4 %} readonly {% endif %}>{{sesion.ASIGNACION}}</textarea>
                                        </div>
                                    </div>
                                </div>
                                <div class="row">
                                        <div class="form-group col-md-6">
                                            <br>
                                            <label class="col-md-6 control-label" name="avancesSesion">Avances:</label>

                                            <div class="col-md-12">
                                                <textarea rows="4" name="avancesSesion" class="form-control"
                                                    id="avancesSesion-{{ sesion.ID }}"
                                                    {% if procesos.IDESTADOPROCESO == 6 or sesion.ESTADOSESION_ID == 4 %} readonly {% endif %}>{{sesion.AVANCES}}</textarea>
                                            </div>
                                        </div>
                                        <div class="form-group col-md-6">
                                            <br>
                                            <label class="col-md-6 control-label" name="avancesSesion">Estado de asignaciones:</label>

                                            <div class="col-md-12">
                                                <textarea rows="4" name="respuestaAvancesSesion" class="form-control"
                                                readonly>{{sesion.RESPUESTA}}</textarea>
                                            </div>
                                        </div>
                                </div>
                                <br>
                                <input type="text" name="proceso" id="proceso" class="d-none" value="{{procesos.ID}}">
                                <input type="text" name="sesion" id="sesion" class="d-none" value="{{sesion.ID}}">
                            </form>
                            
                            
                                <div class="row">
                                    
                                    <!--sector donde se almacenan los documentos y links-->
                                    <div class="form-group col-md-6">
                                        <form class="form-horizontal" action="{% url 'infoSesionCoach' sesion.ID %}" id="formDocumentos-{{ sesion.ID }}"></form>
                                        <label class="col-md-6 control-label" name="nombre">Documentos:</label>
                                        <div class="form-group col-md-12">
                                            <table id="" class="table thead-dark border border-dark">
                                                <thead class="thead-dark">
                                                    <tr class="cabecera">
                                                        <th scope="col">Nombre</th>
                                                        <th scope="col"></th>
                                                    </tr>
                                                </thead>
                                                <tbody>
                                                    {% for gestor in gestoresArchivos %}
                                                       {% if gestor.IDSESION == sesion.ID %}
                                                            <!-- <tr class="bg-light">
                                                                <th scope="row"><a href="{{gestor.LINKGE}}" target="_blank">Archivo: {{ forloop.counter }}</a></th>
                                                                <th scope="row"><i class="far fa-trash-alt float-end mt-1" style="color: red;"></i></th>
                                                            </tr> -->
                                                            <form class="form-horizontal" method="POST" enctype="application/x-www-form-urlencoded" action="{% url 'infoArchivoEliminar' gestor.IDARCHIVO %}" id="formArchivoEliminar-{{gestor.IDARCHIVO}}">{% csrf_token %}
                                                                <input type="text" name="proceso" id="proceso" class="d-none" value="{{procesos.ID}}">
                                                                <input type="text" name="sesion" id="sesion" class="d-none" value="{{sesion.ID}}">
                                                                <tr class="bg-light">
                                                                    <th scope="row"><a href="{{gestor.LINKGE}}" target="_blank">{{gestor.NOMBREARCHIVO}}</a></th>
                                                                    <th scope="row"><button type="button" data-id="{{ gestor.IDARCHIVO }}" class="far fa-trash-alt float-end mt-1" onclick="eliminarArchivo(this);" style="color: red;"></a></button></th>
                                                                </tr>
                                                            </form>
                                                        {% endif %}
                                                    {% endfor %}
                                                    

                                                </tbody>
                                            </table>
                                        </div>
                                        <div class="form-group col-md-12">
                                            <div class="col-md-12">
                                                <!-- <div class="row">
                                                    <input type="file" class="col-md-9" name="archivo" {% if procesos.IDESTADOPROCESO == 6 or sesion.ESTADOSESION_ID == 4 %} disabled {% endif %}>
                                                    <i type="button" class="fas fa-plus-square d-flex justify-content-center col-md-1 mt-2" style="color: green;"></i>
                                                </div> -->
                                                <form class="form-horizontal" method="POST" enctype="multipart/form-data" action="{% url 'infoArchivoSesionCoach' sesion.ID %}" id="formArchivo-{{ sesion.ID }}">{% csrf_token %}
                                                    <input type="text" name="proceso" id="proceso" class="d-none" value="{{procesos.ID}}">
                                                    <input type="text" name="sesion" id="sesion" class="d-none" value="{{sesion.ID}}">
                                                
                                                    <div class="row justify-content-center mt-2">
                                                        <input type="file" class="col-md-9" name="archivo" id="archivo-{{ sesion.ID }}" {% if procesos.IDESTADOPROCESO == 6 or sesion.ESTADOSESION_ID == 4 %} disabled {% endif %}>
                                                        <i type="button" data-id="{{sesion.ID}}" onclick="agregarArchivo(this);" class="fas fa-plus-square d-flex justify-content-center col-md-1 mt-2" style="color: green;"></i>
                                                    </div>
                                                    <div>
                                                        <label style="font-size: 10px; color: red;">*Solo se pueden añadir archivos con formato: doc, docx, xls, ppt, pptx, pdf, jpeg, xlsx</label>
                                                    </div>
                                                </form>
                                            </div>
                                        </div>
                                    </form>
                                    </div>
                                
                                
                                    <div class="form-group col-md-6">
                                        <label class="col-md-6 control-label" name="nombre">Links:</label>
                                        <div class="form-group col-md-12">
                                           
                                            <table id="" class="table thead-dark border border-dark">
                                                <thead class="thead-dark">
                                                    <tr class="cabecera">
                                                        <th scope="col">Dirección</th>
                                                        <th scope="col"></th>
                                                    </tr>
                                                </thead>
                                                <tbody>
                                                    {% for gestor in gestoresEnlaces %}
                                                        {% if gestor.IDSESION == sesion.ID %}
                                                            <form class="form-horizontal" method="POST" enctype="application/x-www-form-urlencoded" action="{% url 'infoEnlaceEliminar' gestor.IDLINK %}" id="formEnlaceEliminar-{{ gestor.IDLINK }}">{% csrf_token %}
                                                                <input type="text" name="proceso" id="proceso" class="d-none" value="{{procesos.ID}}">
                                                                <input type="text" name="sesion" id="sesion" class="d-none" value="{{sesion.ID}}">
                                                                <tr class="bg-light">
                                                                    <th scope="row"><a href="{{gestor.LINKEN}}" target="_blank">{{gestor.LINKEN}}</a></th>
                                                                    <th scope="row"><button type="button" data-id="{{ gestor.IDLINK }}" class="far fa-trash-alt float-end mt-1" onclick="eliminarEnlace(this);" style="color: red;"></a></button></th>
                                                                </tr>
                                                            </form>
                                                        {% endif %}
                                                    {% endfor %}
                                                    
                                                </tbody>
                                            </table>

                                            <form class="form-horizontal" method="POST" enctype="application/x-www-form-urlencoded" action="{% url 'infoEnlaceSesionCoach' sesion.ID %}" id="formEnlace-{{ sesion.ID }}">{% csrf_token %}
                                                <input type="text" name="proceso" id="proceso" class="d-none" value="{{procesos.ID}}">
                                                <input type="text" name="sesion" id="sesion" class="d-none" value="{{sesion.ID}}">
                                            
                                                <div class="row justify-content-center mt-2">
                                                    <textarea style="overflow:auto;resize:none" rows="1" class="form-control col-md-8" id="link-{{ sesion.ID }}" placeholder="Ingrese un Link"
                                                        name="link" {% if procesos.IDESTADOPROCESO == 6 or sesion.ESTADOSESION_ID == 4 %} readonly {% endif %}></textarea>
                                                    <i type="button" data-id="{{sesion.ID}}" onclick="agregarEnlace(this);" class="fas fa-plus-square d-flex justify-content-center col-md-2 mt-2" style="color: green;"></i>
                                                </div>
                                               
                                            </form>
                                        </div>
                                        
                                    </div>
                                </div>
                           
                           <br>
                            <div class="form-group container col-sm-12 col-md-12">
                                <button type="submit" class="btn btn-primary float-end" onclick="modSesiones(this);"
                                    data-id="{{sesion.ID}}" {% if procesos.IDESTADOPROCESO == 6 or sesion.ESTADOSESION_ID == 4 %} disabled {% endif %}
                                    >Guardar Sesión {{ forloop.counter }}</button>
                                <br>
                                <br>
                            </div>
                            <br>
                        </div>
                    </div>
                    
                    {% endfor %}
                    <br>
                </div>
            </div>
        </div>
    </div>
</div>
<!--Boton para almacena la informacion del proceso-->
<div class="container">
    <div class="row">
    <br>
    <a href="{% url 'listProCoach' %}" class="btn btn-secondary float-start col-md-2">Volver</a>
    <span class="col-md-8"></span>
<br>
    <a target="_blank" href="{% url 'imprimirProceso' procesos.ID %}" type="submit"
        class="btn btn-primary float-end col-md-2">Reporte</a>
    </div>
</div>
<br>
<br>
</div>
{% endfor %}

{% if messages %}
{% for message in messages %}

<script>
    Swal.fire({
        title: '{{ message }}',
        icon: '{{ message.tags }}',
        heightAuto: false,
        timer: 3000,
        timerProgressBar: true
    })
</script>
{% endfor %}
{% endif %}
<script>
    function fecha(elem) {
        var today = new Date();
        var id = $(elem).attr("id")
        var dd = today.getDate();
        var mm = today.getMonth() + 1; //January is 0!
        var yyyy = today.getFullYear();
        if (dd < 10) {
            dd = '0' + dd
        }
        if (mm < 10) {
            mm = '0' + mm
        }

        today = yyyy + '-' + mm + '-' + dd;
        document.getElementById("fechaSesion"+'-'+id).setAttribute("min", today);
    };
</script>
{% endblock %}

<!-- Custom script -->
{% block js %}
<link rel="stylesheet" type="text/css" href="{% static 'css/jquery.dataTables.min.css' %}" />
<script type="text/javascript" src="{% static 'js/jquery.dataTables.min.js' %}"></script>
<script>
    $(document).ready(function () {
        var table = $('#fechas').DataTable({
            dom: 'lrtip',
            "ordering": false,
            "lengthMenu": false,
            "lengthChange": false,
            "autoWidth": false,
            "scrollX": true,
            "info": false,
            "paging": false,
        });
    });
</script>
<script>
    $(document).ready(function () {
        var table = $('#tablaArchivos').DataTable({
            dom: 'lrtip',
            "ordering": false,
            "lengthMenu": [5],
            "lengthChange": false,
            "autoWidth": false,
            "scrollX": true,
            "info": false,
            "paginate": false,
            "language": {
                "zeroRecords": "No se encontraron registros.",
                "info": "Mostrando página _PAGE_ de _PAGES_",
                "infoEmpty": "No records available",
                "infoFiltered": "(filtrado de un total de _MAX_ registros)",
                "paginate": {
                    "first": "Primero",
                    "last": "Ultimo",
                    "next": "Siguiente",
                    "previous": "Anterior"
                },
            },

        });
    });
</script>
<script>
    $(document).ready(function () {
        var table = $('#enlaces').DataTable({
            dom: 'lrtip',
            "ordering": false,
            "lengthMenu": [5],
            "lengthChange": false,
            "autoWidth": false,
            "scrollX": true,
            "info": false,
            "paginate": false,
            "language": {
                "zeroRecords": "No se encontraron registros.",
                "info": "Mostrando página _PAGE_ de _PAGES_",
                "infoEmpty": "No records available",
                "infoFiltered": "(filtrado de un total de _MAX_ registros)",
                "paginate": {
                    "first": "Primero",
                    "last": "Ultimo",
                    "next": "Siguiente",
                    "previous": "Anterior"
                },
            },

        });
    });
</script>
<script>
    var coll = document.getElementsByClassName("collapsible");
    var i;

    for (i = 0; i < coll.length; i++) {
        coll[i].addEventListener("click", function () {
            this.classList.toggle("active");
            var content = this.nextElementSibling;
            if (content.style.maxHeight) {
                content.style.maxHeight = null;
            } else {
                content.style.maxHeight = content.scrollHeight + "px";
            }
        });
    }
</script>
{% endblock js %}
